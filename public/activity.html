<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HIGBROKES — Live Activity</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Orbitron:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --cyan: #00ffcc; --red: #ff5555; --gold: #ffcc00;
      --purple: #bb88ff; --green: #55ff88; --orange: #ff8844;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #04060c;
      color: #ccc;
      font-family: 'JetBrains Mono', monospace;
      min-height: 100vh;
    }
    .header {
      padding: 24px 32px;
      border-bottom: 1px solid rgba(0,255,204,0.1);
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--cyan);
      letter-spacing: 0.15em;
    }
    .header .live-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.65rem;
      color: var(--green);
      font-weight: 700;
      letter-spacing: 0.1em;
    }
    .live-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--green);
      box-shadow: 0 0 8px var(--green);
      animation: blink 1.5s infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .token-bar {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 0.7rem;
    }
    .token-bar a {
      color: var(--purple);
      text-decoration: none;
      border: 1px solid rgba(187,136,255,0.3);
      padding: 6px 14px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .token-bar a:hover {
      background: rgba(187,136,255,0.1);
      color: #fff;
    }
    .stats {
      display: flex;
      gap: 24px;
      padding: 20px 32px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      flex-wrap: wrap;
    }
    .stat {
      background: rgba(10,14,30,0.7);
      border: 1px solid rgba(255,255,255,0.04);
      border-radius: 6px;
      padding: 14px 20px;
      min-width: 140px;
    }
    .stat-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.5rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      color: rgba(255,255,255,0.35);
      margin-bottom: 4px;
    }
    .stat-val {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--cyan);
    }
    .stat-val.gold { color: var(--gold); }
    .stat-val.green { color: var(--green); }
    .feed {
      padding: 16px 32px;
    }
    .feed-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.65rem;
      font-weight: 700;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.12em;
      margin-bottom: 12px;
    }
    .feed-list {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .feed-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 4px;
      background: rgba(10,14,30,0.5);
      border: 1px solid rgba(255,255,255,0.02);
      font-size: 0.72rem;
      animation: slide-in 0.3s ease;
    }
    @keyframes slide-in { from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }
    .feed-item:hover { background: rgba(0,255,204,0.03); }
    .f-time { color: rgba(255,255,255,0.2); min-width: 60px; font-size: 0.6rem; }
    .f-agent { color: var(--purple); font-weight: 700; min-width: 70px; }
    .f-action { font-weight: 600; min-width: 50px; }
    .f-action.buy, .f-action.agent_buy { color: var(--green); }
    .f-action.sell, .f-action.agent_sell { color: var(--red); }
    .f-action.win, .f-action.challenge_win { color: var(--gold); }
    .f-action.challenge, .f-action.challenge_create, .f-action.challenge_accept { color: var(--orange); }
    .f-action.tax, .f-action.tax_paid { color: var(--cyan); }
    .f-action.pool_buy, .f-action.pool_trade { color: var(--purple); }
    .f-action.market_buy { color: var(--gold); }
    .f-token { color: rgba(255,255,255,0.6); min-width: 80px; }
    .f-amount { color: var(--gold); margin-left: auto; min-width: 80px; text-align: right; }
    .f-hash a {
      color: rgba(0,255,204,0.4);
      text-decoration: none;
      font-size: 0.6rem;
    }
    .f-hash a:hover { color: var(--cyan); }
    .f-detail { color: rgba(255,255,255,0.25); font-size: 0.6rem; }
    .enter-link {
      display: inline-block;
      margin: 20px 32px;
      padding: 10px 24px;
      background: linear-gradient(135deg, rgba(0,255,204,0.15), rgba(0,255,204,0.05));
      border: 1px solid rgba(0,255,204,0.3);
      border-radius: 6px;
      color: var(--cyan);
      font-family: 'Orbitron', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-decoration: none;
      transition: all 0.2s;
    }
    .enter-link:hover {
      background: rgba(0,255,204,0.15);
      box-shadow: 0 0 20px rgba(0,255,204,0.2);
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>HIGBROKES</h1>
    <div class="live-badge"><div class="live-dot"></div>LIVE</div>
    <div class="token-bar">
      <span style="color:var(--gold)">$WON</span>
      <a href="https://nad.fun/token/0x9d36A73462962d767509FC170c287634A0907777" target="_blank">Trade on nad.fun</a>
    </div>
  </div>

  <div class="stats" id="stats">
    <div class="stat"><div class="stat-label">TRANSACTIONS</div><div class="stat-val" id="s-txs">—</div></div>
    <div class="stat"><div class="stat-label">VOLUME</div><div class="stat-val gold" id="s-vol">—</div></div>
    <div class="stat"><div class="stat-label">ACTIVE AGENTS</div><div class="stat-val green" id="s-agents">—</div></div>
    <div class="stat"><div class="stat-label">NETWORK</div><div class="stat-val">MONAD</div></div>
  </div>

  <a class="enter-link" href="/">ENTER 3D ARENA</a>

  <div class="feed">
    <div class="feed-title">TRANSACTION FEED</div>
    <div class="feed-list" id="feed-list"></div>
  </div>

  <script>
    let lastTime = 0;
    let firstLoad = true;

    async function poll() {
      try {
        const r = await fetch(`/api/activity?limit=100&since=${lastTime}`);
        const data = await r.json();

        // Stats
        document.getElementById('s-txs').textContent = data.stats.totalTransactions;
        document.getElementById('s-vol').textContent = data.stats.totalVolumeMON + ' MON';
        document.getElementById('s-agents').textContent = data.stats.activeAgents;

        // Feed
        const list = document.getElementById('feed-list');
        let entries = data.entries || [];

        if (firstLoad) {
          entries = entries.slice(-50);
          firstLoad = false;
        }

        entries.forEach(e => {
          if (e.time <= lastTime) return;
          lastTime = e.time;

          const div = document.createElement('div');
          div.className = 'feed-item';

          const t = new Date(e.time);
          const timeStr = t.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
          const actionClass = (e.type || e.action || '').toLowerCase();
          const actionLabel = e.action || e.type || '?';
          const hashHtml = e.hash ? `<span class="f-hash"><a href="https://monadscan.com/tx/${e.hash}" target="_blank">${e.hash.slice(0,8)}...${e.hash.slice(-4)}</a></span>` : '';
          const detailHtml = e.detail ? `<span class="f-detail">${e.detail}</span>` : '';
          const partHtml = e.participants ? `<span class="f-detail">${e.participants} agents</span>` : '';

          div.innerHTML = `
            <span class="f-time">${timeStr}</span>
            <span class="f-agent">${e.agent || '?'}</span>
            <span class="f-action ${actionClass}">${actionLabel}</span>
            <span class="f-token">${e.token || ''}</span>
            ${detailHtml}${partHtml}
            <span class="f-amount">${e.amount} MON</span>
            ${hashHtml}
          `;

          list.prepend(div);

          // Keep max 100 visible
          while (list.children.length > 100) list.removeChild(list.lastChild);
        });
      } catch (e) {}
    }

    poll();
    setInterval(poll, 3000);
  </script>
</body>
</html>
